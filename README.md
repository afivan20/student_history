# Student History - –°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É—Ä–æ–∫–æ–≤

–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ–≤–µ–¥—ë–Ω–Ω—ã—Ö —É—Ä–æ–∫–æ–≤ —Å —É—á–µ–Ω–∏–∫–∞–º–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Google Sheets –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Telegram Web App.

## üìã –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üîê **–¢—Ä–∏ —Å–ø–æ—Å–æ–±–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:**
  - Telegram Web App (–æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥)
  - UUID —Ç–æ–∫–µ–Ω—ã (—Å–µ–∫—Ä–µ—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏)
  - –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å JWT

- üìä **Google Sheets –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –¥–∞–Ω–Ω—ã–µ –æ–± —É—Ä–æ–∫–∞—Ö —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Google —Ç–∞–±–ª–∏—Ü–∞—Ö
- ‚ö° **Connection Pooling –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å Google Sheets API
- üë®‚Äçüíº **–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏ –∏ –¥–æ—Å—Ç—É–ø–∞–º–∏
- üîí **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
  - HTTPS only
  - Rate limiting (60 req/min)
  - HMAC-SHA256 –≤–∞–ª–∏–¥–∞—Ü–∏—è Telegram –¥–∞–Ω–Ω—ã—Ö
  - Secure httponly cookies
  - Security headers (CSP, HSTS, X-Frame-Options)
- üìù **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞** –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## üèóÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend:** Python 3.10+, FastAPI, SQLAlchemy
- **Database:** SQLite
- **Frontend:** Semantic UI, Telegram Web App JS
- **Auth:** JWT (–∞–¥–º–∏–Ω–∫–∞), HMAC-SHA256 (Telegram), UUID tokens
- **External API:** Google Sheets API (gspread)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
student_history/
‚îú‚îÄ‚îÄ app.py                          # –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ FastAPI
‚îú‚îÄ‚îÄ student_api.py                  # Google Sheets –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ https_redirect.py               # HTTP‚ÜíHTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç
‚îú‚îÄ‚îÄ migrate.py                      # –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ models.py                       # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îú‚îÄ‚îÄ database.py                     # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îú‚îÄ‚îÄ requirements.txt                # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ .env                            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ .env.example                    # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ auth/                           # –ú–æ–¥—É–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ telegram_auth.py            # Telegram Web App –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ token_auth.py               # UUID —Ç–æ–∫–µ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ middleware.py               # FastAPI dependencies
‚îÇ   ‚îî‚îÄ‚îÄ session.py                  # Cookie helpers
‚îÇ
‚îú‚îÄ‚îÄ admin/                          # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                     # JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ middleware.py               # –ê–¥–º–∏–Ω middleware
‚îÇ   ‚îî‚îÄ‚îÄ routes.py                   # CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ middleware/                     # –û–±—â–∏–µ middleware
‚îÇ   ‚îú‚îÄ‚îÄ rate_limit.py               # Rate limiting
‚îÇ   ‚îî‚îÄ‚îÄ security.py                 # Security headers
‚îÇ
‚îú‚îÄ‚îÄ services/                       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –≤–Ω–µ—à–Ω–∏–µ API
‚îÇ   ‚îî‚îÄ‚îÄ google_sheets.py            # Google Sheets connection manager
‚îÇ
‚îú‚îÄ‚îÄ templates/                      # HTML —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îú‚îÄ‚îÄ index.html                  # Landing page
‚îÇ   ‚îú‚îÄ‚îÄ student.html                # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ admin/                      # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å templates
‚îÇ       ‚îú‚îÄ‚îÄ login.html
‚îÇ       ‚îú‚îÄ‚îÄ dashboard.html
‚îÇ       ‚îú‚îÄ‚îÄ students.html
‚îÇ       ‚îú‚îÄ‚îÄ telegram.html
‚îÇ       ‚îú‚îÄ‚îÄ tokens.html
‚îÇ       ‚îî‚îÄ‚îÄ logs.html
‚îÇ
‚îî‚îÄ‚îÄ static/                         # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
    ‚îî‚îÄ‚îÄ favicon.png
```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd student_history
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
python3 -m venv venv
source venv/bin/activate  # –ù–∞ Windows: venv\Scripts\activate
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:

```env
# Telegram Bot Configuration (–ø–æ–ª—É—á–∏—Ç–µ —É @BotFather)
TELEGRAM_BOT_TOKEN=your_bot_token_here

# Admin Panel Security (—Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—É—é —Å—Ç—Ä–æ–∫—É)
ADMIN_SECRET_KEY=your_random_secret_key_here

# Database
DATABASE_URL=sqlite:///./student_history.db

# SSL Certificates (–¥–ª—è production)
SSL_KEYFILE=/path/to/privkey.pem
SSL_CERTFILE=/path/to/fullchain.pem
```

### 5. Google Sheets API –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ [Google Cloud Console](https://console.cloud.google.com/)
2. –í–∫–ª—é—á–∏—Ç–µ Google Sheets API
3. –°–æ–∑–¥–∞–π—Ç–µ Service Account
4. –°–∫–∞—á–∞–π—Ç–µ JSON –∫–ª—é—á –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ `credentials.json` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
5. –ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–µ–π Google —Ç–∞–±–ª–∏—Ü–µ –¥–ª—è email Service Account

### 6. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `students.json`:

```bash
# –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
python migrate.py students

# –°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
python migrate.py admin admin your_password
```

–ï—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç–µ —Å –Ω—É–ª—è:

```bash
# –°–æ–∑–¥–∞—Ç—å –ø—É—Å—Ç—É—é –ë–î –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
python -c "from database import init_db; init_db()"
python migrate.py admin admin your_password
```

## üéØ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–±–µ–∑ SSL)

```bash
source venv/bin/activate
uvicorn app:app --reload --host 0.0.0.0 --port 8000
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ `http://localhost:8000`

### Production —Ä–µ–∂–∏–º (—Å SSL)

```bash
source venv/bin/activate
python app.py
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 443 —Å HTTPS.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –±–æ—Ç–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/newbot`
3. –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω
4. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env` –∫–∞–∫ `TELEGRAM_BOT_TOKEN`

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Web App –∫–Ω–æ–ø–∫–∏

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/mybots`
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
4. Bot Settings ‚Üí Menu Button
5. Edit Menu Button
6. –í–≤–µ–¥–∏—Ç–µ URL: `https://yourdomain.com` (–∏–ª–∏ –≤–∞—à –¥–æ–º–µ–Ω)
7. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–∫–∏: "–ò—Å—Ç–æ—Ä–∏—è —É—Ä–æ–∫–æ–≤"

–¢–µ–ø–µ—Ä—å —Å—Ç—É–¥–µ–Ω—Ç—ã —É–≤–∏–¥—è—Ç –∫–Ω–æ–ø–∫—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –±–æ—Ç–∞!

## üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä

**–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å:**
```
URL: https://yourdomain.com/admin/login
–õ–æ–≥–∏–Ω: admin (–∏–ª–∏ –≤–∞—à)
–ü–∞—Ä–æ–ª—å: your_password
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ Telegram ID –∫ —Å—Ç—É–¥–µ–Ω—Ç–∞–º
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º Google Sheets (–æ—á–∏—Å—Ç–∫–∞, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞)

### –°—Ç—É–¥–µ–Ω—Ç—ã

**–°–ø–æ—Å–æ–± 1: Telegram Web App (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
1. –°—Ç—É–¥–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –≤–∞—à–µ–≥–æ Telegram –±–æ—Ç–∞
2. –ù–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–ò—Å—Ç–æ—Ä–∏—è —É—Ä–æ–∫–æ–≤"
3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –∏ –≤–∏–¥–∏—Ç —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** Telegram ID —Å—Ç—É–¥–µ–Ω—Ç–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–≤—è–∑–∞–Ω –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏!

**–°–ø–æ—Å–æ–± 2: UUID —Ç–æ–∫–µ–Ω (–∑–∞–ø–∞—Å–Ω–æ–π)**
1. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç—É —Å—Å—ã–ª–∫—É: `https://yourdomain.com/t/{token}`
3. –°—Ç—É–¥–µ–Ω—Ç –º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É –≤ –∑–∞–∫–ª–∞–¥–∫–∏

### –ü—Ä–∏–≤—è–∑–∫–∞ Telegram ID

**–£–∑–Ω–∞—Ç—å Telegram ID —Å—Ç—É–¥–µ–Ω—Ç–∞:**
1. –ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ –Ω–∞–ø–∏—Å–∞—Ç—å –±–æ—Ç—É [@userinfobot](https://t.me/userinfobot)
2. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç Telegram ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, `123456789`)

**–ü—Ä–∏–≤—è–∑–∞—Ç—å –≤ –∞–¥–º–∏–Ω–∫–µ:**
1. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí Telegram
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
3. –í–≤–µ–¥–∏—Ç–µ Telegram ID
4. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–≤—è–∑–∞—Ç—å"

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Google Sheets

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–∏—Å—Ç (worksheet) –≤ —Ç–∞–±–ª–∏—Ü–µ `schedule`:

**–ò–º—è –ª–∏—Å—Ç–∞:** Capitalize –∏–º—è —Å—Ç—É–¥–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Ivan`, `Maria`)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- –ö–æ–ª–æ–Ω–∫–∞ B, —Å—Ç—Ä–æ–∫–∏ 5+: –î–∞—Ç—ã —É—Ä–æ–∫–æ–≤ (—Ñ–æ—Ä–º–∞—Ç: `24-Jan-25`)
- –ö–æ–ª–æ–Ω–∫–∞ C, —Å—Ç—Ä–æ–∫–∏ 5+: –¢–∏–ø —É—Ä–æ–∫–∞ (`–£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω` –∏–ª–∏ `–û–ø–ª–∞—Ç–∞`)
- –Ø—á–µ–π–∫–∞ E3: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Ä–æ–∫–æ–≤ (—á–∏—Å–ª–æ)

**–ü—Ä–∏–º–µ—Ä:**

| A | B | C | D | E |
|---|---|---|---|---|
| | | | | |
| | | | | –î–æ—Å—Ç—É–ø–Ω–æ —É—Ä–æ–∫–æ–≤ |
| | | | | **5** |
| | | | | |
| | 24-Jan-25 | –£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω | | |
| | 23-Jan-25 | –û–ø–ª–∞—Ç–∞ | | |
| | 22-Jan-25 | –£—Ä–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω | | |

## ‚ö° –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Connection Pooling

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç singleton –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è Google Sheets –∫–ª–∏–µ–Ω—Ç–∞:
- ‚úÖ **–û–¥–∏–Ω gspread –∫–ª–∏–µ–Ω—Ç** –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ SSL –æ—à–∏–±–æ–∫** –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry** –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö (3 –ø–æ–ø—ã—Ç–∫–∏ —Å exponential backoff)

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–î–∞–Ω–Ω—ã–µ –∏–∑ Google Sheets –∫–µ—à–∏—Ä—É—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏:
- ‚è±Ô∏è **TTL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:** 5 –º–∏–Ω—É—Ç
- üìä **–ß—Ç–æ –∫–µ—à–∏—Ä—É–µ—Ç—Å—è:** –ò—Å—Ç–æ—Ä–∏—è —É—Ä–æ–∫–æ–≤ –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è TTL

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–µ—à–µ–º

**–ß–µ—Ä–µ–∑ API:**
```bash
# –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à
curl -X POST https://yourdomain.com/admin/cache/clear \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
curl -X POST https://yourdomain.com/admin/cache/clear?student=George \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"

# –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–µ—à–∞
curl https://yourdomain.com/admin/cache/stats \
  -H "Authorization: Bearer YOUR_JWT_TOKEN"
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
```json
{
  "total_entries": 10,
  "active_entries": 8,
  "expired_entries": 2,
  "cache_keys": [
    "student_history:George",
    "student_history:Ivan",
    "student_history:Maria"
  ],
  "last_connection": "2026-01-24T11:13:03.987420"
}
```

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å—Ç—É–¥–µ–Ω—Ç–∞:** ~500-800ms (API –∑–∞–ø—Ä–æ—Å –∫ Google)
- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å:** ~50-100ms (—á—Ç–µ–Ω–∏–µ –∏–∑ –ø–∞–º—è—Ç–∏)
- **–≠–∫–æ–Ω–æ–º–∏—è:** 80-90% –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã

- ‚úÖ **HTTPS only** - –≤—Å–µ cookies —Å —Ñ–ª–∞–≥–æ–º `secure=True`
- ‚úÖ **Rate Limiting** - 60 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É —Å –æ–¥–Ω–æ–≥–æ IP
- ‚úÖ **HMAC-SHA256** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Telegram initData
- ‚úÖ **JWT —Ç–æ–∫–µ–Ω—ã** - –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (8 —á–∞—Å–æ–≤)
- ‚úÖ **Secure cookies** - httponly, samesite=lax
- ‚úÖ **Security headers** - CSP, HSTS, X-Frame-Options
- ‚úÖ **SQL Injection –∑–∞—â–∏—Ç–∞** - SQLAlchemy ORM
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- üîí –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ `ADMIN_SECRET_KEY`
- üîí –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è –∞–¥–º–∏–Ω–∞
- üîí –•—Ä–∞–Ω–∏—Ç–µ `credentials.json` –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- üîí –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- üîí –î–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–ø–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìù API Endpoints

### –ü—É–±–ª–∏—á–Ω—ã–µ

- `GET /` - Landing page (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Telegram Web App)
- `GET /t/{token}` - –í—Ö–æ–¥ —á–µ—Ä–µ–∑ UUID —Ç–æ–∫–µ–Ω
- `GET /student?query=5` - –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞ (—Ç—Ä–µ–±—É–µ—Ç auth)
- `GET /health` - Health check

### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

- `GET/POST /admin/login` - –í—Ö–æ–¥
- `GET /admin/logout` - –í—ã—Ö–æ–¥
- `GET /admin/dashboard` - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- `GET/POST /admin/students` - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏
- `GET/POST /admin/telegram` - –ü—Ä–∏–≤—è–∑–∫–∞ Telegram ID
- `GET/POST /admin/tokens` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID —Ç–æ–∫–µ–Ω–æ–≤
- `GET /admin/logs` - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –¥–æ—Å—Ç—É–ø–∞
- `POST /admin/cache/clear?student={name}` - –û—á–∏—Å—Ç–∏—Ç—å –∫–µ—à Google Sheets (–≤—Å–µ –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ç—É–¥–µ–Ω—Ç)
- `GET /admin/cache/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è Google Sheets

## üêõ Troubleshooting

### –û—à–∏–±–∫–∞: "Telegram auth validation error"

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–≤–µ—Ä–Ω—ã–π TELEGRAM_BOT_TOKEN –≤ `.env`

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω —É @BotFather, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–µ—Ç –ø—Ä–æ–±–µ–ª–æ–≤

### –û—à–∏–±–∫–∞: "Authentication required" –ø—Ä–∏ –≤—Ö–æ–¥–µ —Å—Ç—É–¥–µ–Ω—Ç–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** Telegram ID –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Å—Ç—É–¥–µ–Ω—Ç—É

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–∑–Ω–∞–π—Ç–µ Telegram ID —á–µ—Ä–µ–∑ @userinfobot
2. –ü—Ä–∏–≤—è–∂–∏—Ç–µ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ ‚Üí Telegram

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –∫ Google Sheets

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–≤–µ—Ä–Ω—ã–µ credentials –∏–ª–∏ –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–∞–±–ª–∏—Ü–µ

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `credentials.json`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Service Account email –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ `student_api.py` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `schedule`)

### SSL –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Google Sheets (SSLEOFError)

**–ü—Ä–æ–±–ª–µ–º–∞:** `SSLEOFError: EOF occurred in violation of protocol` –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

**–≠—Ç–æ —É–∂–µ —Ä–µ—à–µ–Ω–æ!** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç connection pooling –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry.

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤—Å–µ –µ—â–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ retry –ø–æ–ø—ã—Ç–∫–∞—Ö
2. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É: `POST /admin/cache/clear`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º
5. –í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ - —É–≤–µ–ª–∏—á—å—Ç–µ `MAX_RETRIES` –≤ `services/google_sheets.py`

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 443

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω—ã root –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –¥–ª—è –ø–æ—Ä—Ç–æ–≤ < 1024

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–ø—É—Å–∫ —Å sudo (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
sudo python app.py

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å reverse proxy (nginx/caddy)
# –í–∞—Ä–∏–∞–Ω—Ç 3: –ó–∞–ø—É—Å–∫ –Ω–∞ –ø–æ—Ä—Ç—É 8000 –≤ dev —Ä–µ–∂–∏–º–µ
uvicorn app:app --port 8000
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
# Ctrl+C –∏–ª–∏ kill –ø—Ä–æ—Ü–µ—Å—Å

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
git pull

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å venv
source venv/bin/activate

# –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
python app.py
```

## üì¶ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞—Ç—å backup
cp student_history.db student_history.db.backup

# –ò–ª–∏ —Å –¥–∞—Ç–æ–π
cp student_history.db student_history_$(date +%Y%m%d).db
```

### –ü–æ–ª–Ω—ã–π backup

```bash
# Backup –≤—Å–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (–∫—Ä–æ–º–µ venv)
tar -czf student_history_backup_$(date +%Y%m%d).tar.gz \
  --exclude='venv' \
  --exclude='*.pyc' \
  --exclude='__pycache__' \
  .
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–õ–∏—á–Ω—ã–π –ø—Ä–æ–µ–∫—Ç. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.

## üë§ –ê–≤—Ç–æ—Ä

–ò–≤–∞–Ω - –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å

## üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏

- FastAPI –∑–∞ –æ—Ç–ª–∏—á–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- Telegram –∑–∞ Web App API
- Google –∑–∞ Sheets API
- Semantic UI –∑–∞ –∫—Ä–∞—Å–∏–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

---

**–í–µ—Ä—Å–∏—è:** 2.1
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** –Ø–Ω–≤–∞—Ä—å 2026

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ v2.1:**
- ‚ö° –î–æ–±–∞–≤–ª–µ–Ω connection pooling –¥–ª—è Google Sheets API
- üíæ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ (TTL 5 –º–∏–Ω—É—Ç)
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø—Ä–∏ SSL –æ—à–∏–±–∫–∞—Ö
- üìä –ê–¥–º–∏–Ω endpoints –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–µ—à–µ–º

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
